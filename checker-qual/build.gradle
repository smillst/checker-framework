sourceSets {
    main {
        java {
            srcDirs = ['generated-src']
        }
    }
}

task copySources(type:Copy){
    description 'Copy checker-qual source from other projects.'
    doFirst {
        // Delete the directory in case a previously copied file should no longer be in checker-qual
        delete file('generated-src/')
    }

    from files('../checker/src', '../dataflow/src', '../framework/src')
    include "**/FormatUtil.java"
    include "**/NullnessUtil.java"
    include "**/RegexUtil.java"
    include "**/UnitsTools.java"
    include "**/SignednessUtil.java"
    include "**/I18nFormatUtil.java"
    include '**/org/checkerframework/**/qual/*.java'
    include '**/Opt.java'
    // TODO: Should we move this into a qual directory?
    include '**/PurityUnqualified.java'

    // Can't overwrite files that are marked as read only.
    // https://github.com/gradle/gradle/issues/1544
    // fileMode(0444)

    into file('generated-src/')
}

compileJava {
    dependsOn copySources
}
clean {
    delete file('generated-src/')
}
