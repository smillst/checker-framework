<project name="jsr-308" basedir="../../..">

    <description>
        Ant utilities for releasing the Checker-Framework.  All targets in this file
        are intended to be run much like method calls (i.e. you must specify a certain set of properties
        as parameters and they do not depend on any other target).
    </description>



    <!-- TODO: Document the params -->
    <target name="checker-framework-website-docs" description="Copies the relevant Checker Framework files to the given directory">
        <!-- This assumes all files have been built; it just does the copying -->

        <!-- The directory in which the Checker Framework has been built -->
        <fail unless="checker"   message="checker property is not set!" />

        <!-- The properties set by release_build.py -->
        <fail unless="dest.dir"   message="dest.dir property is not set!" />
        <fail unless="manual.name"        message="manual.name property is not set!" />
        <fail unless="dataflow.manual.name" message="dataflow.manual.name property is not set!" />
        <fail unless="checker.webpage"   message="checker.webpage property is not set!" />

        <!-- //TODO: PERHAPS CHECK THAT THESE FILES EXIST -->
        <property name="cf.docs"          value="${checker}/../docs" />
        <property name="checker.manual"   value="${cf.docs}/manual" />
        <property name="checker.logo"     value="${cf.docs}/logo" />
        <property name="developer.dir"   value="${cf.docs}/developer" />
        <property name="dataflow.manual"  value="${checker}/../dataflow/manual" />
        <property name="checker.tutorial" value="${cf.docs}/tutorial" />
        <property name="dest.dir.manual"         value="${dest.dir}/manual" />
        <property name="web.root"         value="${dest.dir}/../.." />

        <copy file="${cf.docs}/${checker.webpage}" tofile="${dest.dir}/${checker.webpage}" />

        <mkdir dir="${dest.dir.manual}" />

        <copy file="${checker.manual}/manual.html" tofile="${dest.dir.manual}/${manual.name}.html"/>
        <symlink link="${dest.dir.manual}/index.html" resource="${manual.name}.html" />
        <copy file="${checker.manual}/manual.pdf"  tofile="${dest.dir.manual}/${manual.name}.pdf"/>

        <copy file="${dataflow.manual}/dataflow.pdf"  tofile="${dest.dir.manual}/${dataflow.manual.name}.pdf" failonerror="false"/>
        <copy file="${developer.dir}/developer-manual.html"  tofile="${dest.dir.manual}/developer-manual.html" failonerror="false"/>
        <copy file="${developer.dir}/gsoc-ideas.html"  tofile="${dest.dir.manual}/gsoc-ideas.html" failonerror="false"/>
        <copy file="${developer.dir}/new-contributor-projects.html"  tofile="${dest.dir.manual}/new-contributor-projects.html" failonerror="false"/>

        <copy todir="${dest.dir.manual}" flatten="true">
            <fileset dir="${checker.manual}">
                <include name="*.svg"/>
                <include name="manual001.png"/>
                <include name="manual001.svg"/>
            </fileset>
        </copy>

        <copy file="${checker.logo}/Logo/CFLogo.png" tofile="${web.root}/CFLogo.png" />
        <copy file="${checker.logo}/Logo/CFLogo.png" tofile="${checker.manual}/CFLogo.png" />
        <copy file="${checker.logo}/Logo/CFLogo.png" tofile="${dest.dir.manual}/CFLogo.png" />
        <copy file="${checker.logo}/Logo/CFLogo.png" tofile="${dest.dir}/docs/tutorial/CFLogo.png" />
        <copy file="${checker.logo}/Logo/CFLogo.png" tofile="${dest.dir}/docs/tutorial/webpages/CFLogo.png" />

        <copy file="${checker.logo}/Checkmark/CFCheckmark_favicon.png" tofile="${dest.dir}/favicon-checkerframework.png" />
        <copy file="${checker.logo}/Checkmark/CFCheckmark_favicon.png" tofile="${dest.dir.manual}/favicon-checkerframework.png" />
        <copy file="${checker.logo}/Checkmark/CFCheckmark_favicon.png" tofile="${web.root}/favicon-checkerframework.png" />

        <copy todir="${dest.dir}/tutorial" >
            <fileset dir="${checker.tutorial}" includes="**"/>
        </copy>

        <copy todir="${dest.dir}" file="${checker}/../docs/CHANGELOG.md" />

        <copy todir="${dest.dir}/api" flatten="false">
            <fileset dir="${checker}/../docs/api">
                <include name="**" />
            </fileset>
        </copy>

        <symlink overwrite="true" link="${dest.dir}/index.html" resource="${checker.webpage}" />

    </target>

    <target name="update-and-copy-maven-example" description="Update version/repo information of the Maven example and copy it to dest.dir">

        <fail unless="dest.dir"   message="dest.dir property is not set!" />
        <fail unless="checker"    message="checker property is not set!" />
        <fail unless="version"    message="version is not set!" />

        <property name="cf.docs"             value="${checker}/../docs"  />
        <property name="cf.docs.examples"    value="${cf.docs}/examples" />

        <copy todir="${dest.dir}/MavenExample" flatten="false">
            <fileset dir="${cf.docs.examples}/MavenExample">
                <include name="**" />
            </fileset>
        </copy>

        <!-- examples -->
        <update file="${dest.dir}/MavenExample/pom.xml"
                start="${checkers.ver.0}" end="${checkers.ver.1}"
                with="${version}"/>
    </target>

    <!-- Run from parent directory as: ant -e -file release/release.xml pylint -->
    <target name="pylint" description="Run pylint on Python code">
        <apply executable="pylint">
            <arg value="--output-format=parseable"/>
            <arg value="--rcfile=docs/developer/release/.pylintrc"/>
            <srcfile/>
            <fileset dir="." includes="docs/developer/release/*.py"/>
        </apply>
    </target>

</project>
